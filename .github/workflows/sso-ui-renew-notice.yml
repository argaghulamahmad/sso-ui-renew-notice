name: SSO UI Renew Notice

on:
  push:
    branches:
      - master

  schedule:
  - cron: "*/10 * * * *"

jobs:
  sso_ui_renew_notice:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
         persist-credentials: false
         fetch-depth: 0

      - name: Install Google Chrome
        run: |
          wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -
          sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google-chrome.list'
          apt-get -y update
          apt-get install -y google-chrome-stable

      - name: Install Chromedriver
        run: |
          wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -
          sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google-chrome.list'
          apt-get -y update
          apt-get install -y google-chrome-stable
          ENV DISPLAY=:99

      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v1
        with:
          python-version: ${{ matrix.python-version }}

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Lint with flake8
        run: |
          pip install flake8
          # stop the build if there are Python syntax errors or undefined names
          flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
          # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide
          flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics

      - name: Run sso-login script
        run: |
          chmod +x ./sso-ui-renew-notice.sh
          ./sso-ui-renew-notice.sh

      - name: Commit changes
          run: |
            git config --local user.email "argaghulamahmad@gmail.com"
            git config --local user.name "Arga Ghulam Ahmad"
            git add -A

            git commit -m "SSO UI Renew Notice"
